# Учет сдельной работы бригад 3.1 (CustomTkinter + SQLite)

## Быстрый запуск

### Windows (рекомендуется)
1. Дважды кликните на `run_project.bat`
2. Приложение запустится автоматически

### Альтернативные способы
- **PowerShell**: `.\run_project.ps1`
- **Ручной запуск**: см. `SETUP.md`

## Первоначальная настройка

Если проект запускается впервые:
1. Убедитесь, что Python 3.12+ установлен
2. Виртуальное окружение уже создано в папке `venv/`
3. Все зависимости установлены автоматически
4. Для переустановки зависимостей: `python -m pip install -r requirements.txt`

При первом запуске:
- Будет создан файл БД и применена схема.
- Будет выполнен автоматический бэкап с ротацией до 20 копий в папке `backups/`.

## Структура
- `config/` — настройки
- `db/` — соединение, схема и SQL-запросы
- `services/` — бизнес-логика, валидация, автодополнение
- `reports/` — отчеты и экспорт (HTML, PDF, Excel)
- `import_export/` — импорт/экспорт Excel
- `gui/` — интерфейс CustomTkinter
- `utils/` — логирование, бэкапы
- `tests/` — тесты pytest

## Примечания
- Экспорт PDF использует `reportlab`.
- Аналитика и экспорт используют `pandas`.
- Автодополнение выполняется префиксным поиском в SQLite (`LIKE 'prefix%'`).

## Файлы настройки
- `SETUP.md` - подробные инструкции по настройке
- `run_project.bat` - скрипт запуска для Windows
- `run_project.ps1` - PowerShell скрипт запуска
- `venv/` - виртуальное окружение Python с зависимостями
- `NETWORK_DB.md` - как подключить общую сетевую БД (мультипользовательский режим)

## Secrets и CI

- **Yandex Disk token**: приложение читает OAuth-токен для автозагрузки с Яндекс.Диска из переменной окружения `YADISK_OAUTH_TOKEN` или из пользовательских настроек (`user_settings.json`). **Никогда** не храните токен в `config/settings.py` или в репозитории.
- Рекомендуется создать файл `secrets.env` (в корне проекта, не добавляемый в репозиторий) с содержимым:

```bash
YADISK_OAUTH_TOKEN=your_real_token_here
```

Загрузите его перед запуском в PowerShell, например:

```powershell
Get-Content .\secrets.env | Foreach-Object { $pair = $_.Split('=',2); [System.Environment]::SetEnvironmentVariable($pair[0], $pair[1]) }
```

Также рекомендовано настроить CI (например, GitHub Actions) и добавить проверки линтера/тестов. В репозитории добавлен пример workflow для этого.
