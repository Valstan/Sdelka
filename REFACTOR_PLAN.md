# План рефакторинга AppWindow

## Текущие проблемы:
1. **Монолитная структура** - 683+ строк в одном классе
2. **Смешение ответственности** - UI, бизнес-логика, управление состоянием
3. **Дублирование кода** - повторяющиеся паттерны создания форм
4. **Сложность тестирования** - все в одном классе

## Новая архитектура:

### 1. Разделение на компоненты:
```
gui/
├── windows/
│   └── app_window.py          # Главное окно (упрощенное)
├── components/
│   ├── tab_manager.py         # Управление вкладками
│   ├── form_factory.py        # Фабрика форм
│   ├── sync_manager.py        # Управление синхронизацией
│   └── ui_state_manager.py    # Управление состоянием UI
├── forms/                     # Существующие формы (без изменений)
└── widgets/                   # Существующие виджеты (без изменений)
```

### 2. Новые классы:

#### AppWindow (упрощенный)
- Только создание основного окна
- Инициализация компонентов
- Обработка событий закрытия

#### TabManager
- Управление вкладками
- Создание и переключение между вкладками
- Настройка шрифтов вкладок

#### FormFactory
- Создание форм для разных режимов (readonly/full)
- Кэширование форм
- Управление жизненным циклом форм

#### SyncManager
- Управление синхронизацией
- Периодические задачи
- Обработка ошибок синхронизации

#### UIStateManager
- Управление состоянием UI
- Обработка изменений режима
- Уведомления о изменениях

### 3. Преимущества новой архитектуры:
- **Разделение ответственности** - каждый класс отвечает за свою область
- **Легкость тестирования** - можно тестировать компоненты отдельно
- **Переиспользование** - компоненты можно использовать в других окнах
- **Читаемость** - код становится более понятным
- **Расширяемость** - легко добавлять новые функции

### 4. План миграции:
1. Создать новые классы-компоненты
2. Перенести логику из AppWindow в соответствующие компоненты
3. Обновить AppWindow для использования компонентов
4. Добавить тесты для новых компонентов
5. Удалить старый код

### 5. Пример новой структуры AppWindow:
```python
class AppWindow(ctk.CTk):
    def __init__(self):
        super().__init__()
        self._setup_window()
        self._init_components()
        self._build_ui()
    
    def _setup_window(self):
        # Только настройка окна
        
    def _init_components(self):
        self.tab_manager = TabManager(self)
        self.form_factory = FormFactory()
        self.sync_manager = SyncManager(self)
        self.ui_state_manager = UIStateManager(self)
        
    def _build_ui(self):
        self.tab_manager.create_tabs()
        # Остальная логика делегируется компонентам
```
