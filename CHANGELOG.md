## 3.9 от 2 сентября 2025 года

### Добавлено
- Отдельная программа сборки: `build_exe.py` (CLI) и `build_exe_gui.py` (tkinter GUI) — сборка .exe вне основного приложения.
- Глобальная плашка «Режим просмотра» справа от вкладок, видна во всех разделах.
- Кнопки экспорта в каждом справочном разделе: Работники, Виды работ, Изделия, Контракты.
- Управление паролем пользователя в Настройках: установка (если не был), смена (c вводом текущего).

### Изменено
- Импорт «Полный доступ» теперь требует установленный пользовательский пароль или админ-пароль; при первом запуске предлагает установить пароль.
- Раздел «Настройки» переработан: 
  - Все операции с БД объединены в «База данных» (копия/слияние, импорт данных, путь к файлу, список и откат версий).
  - «Настройки интерфейса» перенесены в конец, после «Пароль пользователя».
- Экспорт из «Настроек» удалён, перемещён ближе к соответствующим данным.
- Подавлены лишние stacktrace в логах при попытках записи в режиме «Просмотр» (readonly DB).

### Удалено
- Кнопка «Версии программы» и отображение истории версий в интерфейсе (история ведётся в CHANGELOG.md).

# Журнал изменений

## 3.8 от 1 сентября 2025 года

### Добавлено
- Экспорт в 1С переведён на единый формат JSON; кнопка в отчётах обновлена.
- Раздел "Версии базы данных": выбор резервной копии и переход на неё; список обновляется кнопкой.
- Детектор типов документов стал балльным с подсказками по колонкам; dry-run показывает рекомендации.

### Изменено
- Единый импорт: при профиле "Наряды" импортируются только наряды; при "Авто" — наряды и виды работ; для XLSX спец-режим нарядов запускается только при реальном наличии листов нарядов.
- Парсер видов работ стал устойчив к вариантам заголовков (Ед. изм., Расценка/Стоимость) и к заголовкам не в первой строке.
- Настройки: упрощены — убраны элементы WAL/таймаут из UI; применяются безопасные дефолты (WAL=on, 10s timeout). Кнопки управления БД перенесены под поле пути.

### Исправлено
- Импорт работников: извлечение номера цеха из шапки ("цех № N"), поддержка файлов без явного столбца "Табель"; улучшено распознавание CSV/XLSX.
- Импорт изделий из нарядов: очистка мусорных хвостов номеров ("+", "-повторно", "-правая", "-рекламационный"), сохранение суффикса вида "-<цифры>" как части номера.
- Первый запуск: снижена вероятность ошибок Tk "after script" при закрытии.

---

## 3.7 от 29 августа 2025 года

### Добавлено
- Единый модуль импорта данных и одна кнопка «Импорт данных» в настройках
- Профили импорта на русском: «Авто», «Наряды», «Цена-лист», «Справочники»
- Черновой прогон (dry-run) с HTML-отчётом и автозапуском отчёта после импорта
- Автоматическое резервное копирование БД перед реальной записью

### Изменено
- Улучшен детектор типов документов (контракты не путаются с изделиями)
- Прогресс импорта обновляется корректно в UI (без ошибок отрисовки)

## 3.6 от 28 августа 2025 года

### Исправлено
- Исправлена проблема с импортом изделий и контрактов из CSV файлов
- Улучшен алгоритм парсинга оборотно-сальдовой ведомости по счету 002
- Оптимизирована логика группировки данных по изделиям и контрактам
- Убраны отладочные сообщения для production-использования
- Модуль импорта теперь корректно обрабатывает сложную структуру CSV данных

### Технические улучшения
- Переработан алгоритм парсинга с использованием state machine подхода
- Улучшены регулярные выражения для извлечения номеров изделий и контрактов
- Добавлена поддержка различных форматов дат и организаций
- Оптимизирована обработка больших CSV файлов

## 3.5 от 28 августа 2025 года

### Добавлено
- Новый модуль импорта изделий с привязкой к контрактам из CSV файлов
- Автоматический парсинг оборотно-сальдовой ведомости по счету 002
- Извлечение информации об изделиях (двигатели) и контрактах
- Автоматическое связывание изделий с соответствующими контрактами
- Создание системного контракта "Без контракта" для изделий без привязки
- Кнопка "Импорт изделий с контрактами" в настройках программы
- Поддержка прогресс-бара для длительных операций импорта

### Изменено
- Версия программы обновлена до 3.5
- Интерфейс настроек дополнен новой функциональностью импорта

## 3.4 от 28 августа 2025 года

### Добавлено
- Полная поддержка всех полей контрактов в интерфейсе справочника
- Новые поля контрактов: Наименование, Вид контракта, Исполнитель, ИГК, Номер контракта, Отдельный счет
- Расширенная таблица контрактов с отображением всех полей
- Улучшенная форма редактирования контрактов с 5 строками полей

### Изменено
- Интерфейс справочника контрактов полностью переработан для отображения всех полей
- Таблица контрактов теперь показывает 10 колонок вместо 4
- Форма редактирования контрактов расширена для работы со всеми полями базы данных
- Автоматическое сохранение и загрузка всех полей контрактов

---

## 3.3 от 28 августа 2025 года

### Добавлено
- Автоматическое создание контракта "Без контракта" для изделий без привязки
- Автопривязка изделий без контракта к контракту "Без контракта"

### Изменено
- Логика проверки контрактов изделий: изделия без контракта автоматически привязываются к "Без контракта"
- Импорт изделий: изделия без контракта автоматически привязываются к "Без контракта"
- Слияние баз данных: изделия без контракта привязываются к "Без контракта" в целевой базе

---

## 3.2 от 26 августа 2025 года

### Добавлено
- Постраничная подгрузка списка нарядов (100 за раз) с автодогрузкой при прокрутке.
- Новая схема отображения «Видов работ» в форме наряда: строгая табличная сетка, обрезка длинных названий с многоточием.
- Импорт XLSX/ODS из многолистовых файлов: автоматическое распознавание прайс-листов и нарядов, создание нарядов, поиск/создание работников, изделий и контрактов; прогресс-бар.
- Сухой анализ книги импорта (без записи в БД) для быстрой проверки структур.
- Расширенная логика импорта по примерам 11.csv/12.csv:
  - Для изделий: name = «Изделие», product_no = код; удаляются пометки «повтор».
  - Дата наряда: день+месяц из строки «ДД.ММ.», год — из шапки листа.
  - Контракт: берётся из шапки («контракт/шифр …»), иначе «ИМПОРТ_<год>».
  - На каждое изделие создаётся отдельный наряд; количества работ не делятся — каждой позиции ставится исходное количество.

### Исправлено
- Позиционирование и работа прокрутки в списках «Видов работ» и «Работников»; ускорена прокрутка колёсиком.
- Кнопка «Отмена» всегда активна (и в просмотре наряда), очистка формы возвращает поля в режим ввода.
- Фильтры в отчётах: «Вид работ» и «Изделие» корректно работают как по id, так и по тексту; не ломают генерацию отчётов.
- Экспорт PDF: перенос длинных текстов внутри ячейки, авто-ужатие ширин, разбиение больших таблиц на части для предотвращения ошибок размещения.

### Изменено
- Диалог выбора файла для импорта теперь принимает форматы: .xlsx, .xls, .ods.

---

## 3.1 от 25 августа 2025 года

### Добавлено
- Статус работника (Работает / Уволен) в базе данных и интерфейсе
- Подсветка уволенных работников красным в списке
- Блокировка добавления уволенных работников в новые наряды
- Импорт работников из Excel с поддержкой колонки «Статус»
- Экспорт работников в Excel с колонкой «Статус» и сортировкой: статус → цех → должность (начальники первыми) → ФИО
- Отчеты: единый режим «один работник» — шапка с ФИО (Фамилия И.О.) и цехом, подписи; скрытие колонок «Работник» и «Цех» в таблице

### Исправлено
- PDF экспорт: устранена ошибка с использованием переменной вне области видимости при вычислении ширин
- Отчеты: корректное определение работника и отдела в контексте для шапок/подписей

---

## [3 сетевая от 18 августа 2025 года] - 2025-01-18

### Добавлено
- Новый формат версионирования "3 сетевая от [дата]"
- Русские названия месяцев в версии
- Автоматическое обновление даты при изменениях в коде
- **Кнопка "Просмотр изменений" в разделе "Настройки"**
  - Отображает историю изменений программы в удобном формате
  - Показывает даты и краткие описания изменений, исправлений
  - Возможность копирования в буфер обмена
  - Структурированный список по версиям с эмодзи-индикаторами

### Изменено
- Версионирование переведено на формат "3 сетевая от [дата]"
- Основная ветка разработки перенесена в v3

### Исправлено
- Подготовка к стабилизации версии 2
- **КРИТИЧЕСКОЕ ИСПРАВЛЕНИЕ**: Проблема с добавлением нескольких работников в наряды
  - Улучшена валидация работников в форме создания/редактирования нарядов
  - Добавлена автоматическая обработка дублирующихся ID работников
  - Улучшена обработка ошибок с подробным логированием
  - Добавлены проверки корректности ID работников
  - Исправлена проблема "Найдены некорректные работники в составе бригады"

---

## [2.9.X.X] - 2025-XX-XX

### Добавлено
- Система ролей пользователей (Полный доступ / Только просмотр)
- Режим "только чтение" с защитой на уровне БД
- Диалог выбора режима при запуске
- Настройки размера шрифта UI с живым применением
- Кнопка "Печать" для отчетов
- Оптимизация PDF отчетов (авто-ориентация, умное масштабирование шрифтов)
- Нормализация заголовков колонок во всех отчетах
- Улучшенная компоновка в разделе "Наряды"
- Перенос функционала "Импорт/Экспорт" в "Настройки"
- Кнопка "Собрать .exe" с окном логов в реальном времени
- Система версионирования 2.Y.M.N на основе изменений файлов
- Автоматическое скрытие подсказок через 5 секунд
- Подсказки появляются сразу при фокусе на поле
- Точное позиционирование подсказок автодополнения
- История использования для автодополнения
- Календарь для выбора дат во всех полях
- Кнопки "Отмена" во всех режимах редактирования
- Загрузка, редактирование и удаление существующих нарядов
- Раздел "Отчеты" с фильтрами и экспортом (HTML, PDF, Excel)
- Импорт/экспорт Excel для справочных данных
- Поиск без учета регистра в базе данных
- Слияние баз данных
- Создание резервных копий БД

### Изменено
- Улучшен интерфейс создания/редактирования нарядов
- Оптимизирована компоновка форм для лучшей адаптивности
- Улучшена система автодополнения и подсказок
- Переработана система отчетов без предварительного просмотра
- Улучшена обработка PDF экспорта

### Исправлено
- Проблемы с шрифтами в PDF (поддержка кириллицы)
- Переполнение текста в отчетах
- Позиционирование элементов интерфейса
- Валидация внешних ключей при создании нарядов
- Проблемы с календарем (блокировка интерфейса)
- Автоматическое скрытие подсказок

---

## [2.0.0.0] - 2025-XX-XX

### Добавлено
- Базовая функциональность учета сдельной работы
- GUI на CustomTkinter
- SQLite база данных
- Система отчетов
- Экспорт в различные форматы
